{
  "hash": "491bcbf3a9b3845e2d20efbc674cd290",
  "result": {
    "markdown": "---\ntitle: National Weather Service Portland, Part II\nauthor: RWW\ndate: '2022-03-18'\nslug: nws-monthly-part-ii\ncategories:\n  - ggplot\n  - tidyverse\n  - time series\ntags:\n  - time series\n  - tidyverse\n---\n\n\n\n\n## Loading NWS Data\n\nI first will try to load it without any intervention to see what it looks like.  As we will see, it is quite messy in a few easy ways and a few that are a bit more tricky.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS <- read.csv(url(\"https://www.weather.gov/source/pqr/climate/webdata/Portland_dailyclimatedata.csv\"))\nhead(NWS, 10) %>% kable() %>%\n    kable_styling() %>%\n    scroll_box(width = \"100%\", height = \"500px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; \"><table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> Daily.Temperature.and.Precipitation.Data </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.1 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.2 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.3 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.4 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.5 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.6 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.7 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.8 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.9 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.10 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.11 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.12 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.13 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.14 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.15 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.16 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.17 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.18 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.19 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.20 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.21 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.22 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.23 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.24 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.25 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.26 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.27 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.28 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.29 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.30 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.31 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.32 </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\"> X.33 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Portland, Oregon Airport </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Data Starts: </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> 13 Oct 1940 </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> END Year: </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> 2019 </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> TX is Maximum Temperature (deg F), TX is Minimum Temperature (deg F), PR is Precipitation (inches), SN is Snowfall  (inches) </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Example:   High Temperature  23 October 1940 is 58 while low was 53 deg. </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> YR </td>\n   <td style=\"text-align:left;\"> MO </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:left;\"> 6 </td>\n   <td style=\"text-align:left;\"> 7 </td>\n   <td style=\"text-align:left;\"> 8 </td>\n   <td style=\"text-align:left;\"> 9 </td>\n   <td style=\"text-align:left;\"> 10 </td>\n   <td style=\"text-align:left;\"> 11 </td>\n   <td style=\"text-align:left;\"> 12 </td>\n   <td style=\"text-align:left;\"> 13 </td>\n   <td style=\"text-align:left;\"> 14 </td>\n   <td style=\"text-align:left;\"> 15 </td>\n   <td style=\"text-align:left;\"> 16 </td>\n   <td style=\"text-align:left;\"> 17 </td>\n   <td style=\"text-align:left;\"> 18 </td>\n   <td style=\"text-align:left;\"> 19 </td>\n   <td style=\"text-align:left;\"> 20 </td>\n   <td style=\"text-align:left;\"> 21 </td>\n   <td style=\"text-align:left;\"> 22 </td>\n   <td style=\"text-align:left;\"> 23 </td>\n   <td style=\"text-align:left;\"> 24 </td>\n   <td style=\"text-align:left;\"> 25 </td>\n   <td style=\"text-align:left;\"> 26 </td>\n   <td style=\"text-align:left;\"> 27 </td>\n   <td style=\"text-align:left;\"> 28 </td>\n   <td style=\"text-align:left;\"> 29 </td>\n   <td style=\"text-align:left;\"> 30 </td>\n   <td style=\"text-align:left;\"> 31 </td>\n   <td style=\"text-align:left;\"> AVG or Total </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1940 </td>\n   <td style=\"text-align:left;\"> 10 </td>\n   <td style=\"text-align:left;\"> TX </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> 75 </td>\n   <td style=\"text-align:left;\"> 70 </td>\n   <td style=\"text-align:left;\"> 64 </td>\n   <td style=\"text-align:left;\"> 72 </td>\n   <td style=\"text-align:left;\"> 72 </td>\n   <td style=\"text-align:left;\"> 78 </td>\n   <td style=\"text-align:left;\"> 78 </td>\n   <td style=\"text-align:left;\"> 64 </td>\n   <td style=\"text-align:left;\"> 63 </td>\n   <td style=\"text-align:left;\"> 61 </td>\n   <td style=\"text-align:left;\"> 58 </td>\n   <td style=\"text-align:left;\"> 57 </td>\n   <td style=\"text-align:left;\"> 57 </td>\n   <td style=\"text-align:left;\"> 57 </td>\n   <td style=\"text-align:left;\"> 56 </td>\n   <td style=\"text-align:left;\"> 53 </td>\n   <td style=\"text-align:left;\"> 59 </td>\n   <td style=\"text-align:left;\"> 59 </td>\n   <td style=\"text-align:left;\"> 52 </td>\n   <td style=\"text-align:left;\"> M </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1940 </td>\n   <td style=\"text-align:left;\"> 10 </td>\n   <td style=\"text-align:left;\"> TN </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> 57 </td>\n   <td style=\"text-align:left;\"> 53 </td>\n   <td style=\"text-align:left;\"> 52 </td>\n   <td style=\"text-align:left;\"> 50 </td>\n   <td style=\"text-align:left;\"> 58 </td>\n   <td style=\"text-align:left;\"> 58 </td>\n   <td style=\"text-align:left;\"> 59 </td>\n   <td style=\"text-align:left;\"> 54 </td>\n   <td style=\"text-align:left;\"> 48 </td>\n   <td style=\"text-align:left;\"> 41 </td>\n   <td style=\"text-align:left;\"> 53 </td>\n   <td style=\"text-align:left;\"> 48 </td>\n   <td style=\"text-align:left;\"> 41 </td>\n   <td style=\"text-align:left;\"> 38 </td>\n   <td style=\"text-align:left;\"> 37 </td>\n   <td style=\"text-align:left;\"> 45 </td>\n   <td style=\"text-align:left;\"> 48 </td>\n   <td style=\"text-align:left;\"> 50 </td>\n   <td style=\"text-align:left;\"> 46 </td>\n   <td style=\"text-align:left;\"> M </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1940 </td>\n   <td style=\"text-align:left;\"> 10 </td>\n   <td style=\"text-align:left;\"> PR </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> 0.01 </td>\n   <td style=\"text-align:left;\"> T </td>\n   <td style=\"text-align:left;\"> T </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0.13 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> T </td>\n   <td style=\"text-align:left;\"> 0.14 </td>\n   <td style=\"text-align:left;\"> 0.05 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0.63 </td>\n   <td style=\"text-align:left;\"> 1.03 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> T </td>\n   <td style=\"text-align:left;\"> 0.18 </td>\n   <td style=\"text-align:left;\"> 0.58 </td>\n   <td style=\"text-align:left;\"> 0.5 </td>\n   <td style=\"text-align:left;\"> 0.25 </td>\n   <td style=\"text-align:left;\"> M </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1940 </td>\n   <td style=\"text-align:left;\"> 10 </td>\n   <td style=\"text-align:left;\"> SN </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> M </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 0 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\nThe column names are stored in the seventh row; to properly import this.  In addition, there are two missing value codes: `M` and `-` that will have to be accounted for.  I will use `skip` to skip the first 6 rows and declare two distinct values to be encoded as missing.  Let's see what we get.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS <- read.csv(url(\"https://www.weather.gov/source/pqr/climate/webdata/Portland_dailyclimatedata.csv\"), skip=6, na.strings = c(\"M\",\"-\"))\nhead(NWS, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     YR MO  X   X1   X2   X3   X4   X5   X6   X7   X8   X9  X10  X11  X12  X13\n1  1940 10 TX <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA>   75\n2  1940 10 TN <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA>   57\n3  1940 10 PR <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> 0.01\n4  1940 10 SN <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA> <NA>    0\n5  1940 11 TX   52   53   47   55   51   58   56   50   48   47   46   45   45\n6  1940 11 TN   40   38   36   32   42   46   46   42   35   34   35   33   34\n7  1940 11 PR 0.17 0.02    T    0 0.07 0.28 0.85 0.29 0.02 0.01 0.01    0    0\n8  1940 11 SN    0    0    0    0    0    0    0    0    0    0    0    0    0\n9  1940 12 TX   51   53   52   51   56   54   50   51   48   50   46   45   43\n10 1940 12 TN   42   40   42   42   44   37   34   35   32   26   34   28   27\n   X14 X15 X16  X17  X18 X19  X20  X21 X22  X23  X24 X25 X26  X27  X28  X29 X30\n1   70  64  72   72   78  78   64   63  61   58   57  57  57   56   53   59  59\n2   53  52  50   58   58  59   54   48  41   53   48  41  38   37   45   48  50\n3    T   T   0 0.13    0   T 0.14 0.05   0 0.63 1.03   0   0    T 0.18 0.58 0.5\n4    0   0   0    0    0   0    0    0   0    0    0   0   0    0    0    0   0\n5   47  53  49   46   49  46   49   50  44   42   44  51  44   45   59   57  45\n6   33  28  27   36   30  29   36   33  28   37   35  37  36   38   43   40  39\n7    0   0   0 0.29 0.01   0 0.37    T   0 0.12 0.62   0   0 0.51 0.89    T   T\n8    0   0   0    0    0   0    0    0   0    0    0   0   0    0    0    0   0\n9   40  39  39   41   41  45   46   62  60   56   53  54  45   50   51   43  44\n10  25  29  33   35   34  35   41   39  39   42   42  42  40   38   36   35  37\n    X31 AVG.or.Total\n1    52         <NA>\n2    46         <NA>\n3  0.25         <NA>\n4     0            0\n5  <NA>         49.1\n6  <NA>         35.9\n7  <NA>         4.53\n8  <NA>            0\n9    45         48.5\n10   32           36\n```\n:::\n:::\n\n\nTwo other things are of note.  The first one is that R really doesn't like columns to be named as numbers so we have an `X` in front of the numeric days.  The second is that the column denoting which variable the rows represent is now `X`.  Let me rename `X` to be `Variable`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS <- read.csv(url(\"https://www.weather.gov/source/pqr/climate/webdata/Portland_dailyclimatedata.csv\"), skip=6, na.strings = c(\"M\",\"-\")) %>% \n  rename(Variable = X)\nstr(NWS)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t3808 obs. of  35 variables:\n $ YR          : int  1940 1940 1940 1940 1940 1940 1940 1940 1940 1940 ...\n $ MO          : int  10 10 10 10 11 11 11 11 12 12 ...\n $ Variable    : chr  \"TX\" \"TN\" \"PR\" \"SN\" ...\n $ X1          : chr  NA NA NA NA ...\n $ X2          : chr  NA NA NA NA ...\n $ X3          : chr  NA NA NA NA ...\n $ X4          : chr  NA NA NA NA ...\n $ X5          : chr  NA NA NA NA ...\n $ X6          : chr  NA NA NA NA ...\n $ X7          : chr  NA NA NA NA ...\n $ X8          : chr  NA NA NA NA ...\n $ X9          : chr  NA NA NA NA ...\n $ X10         : chr  NA NA NA NA ...\n $ X11         : chr  NA NA NA NA ...\n $ X12         : chr  NA NA NA NA ...\n $ X13         : chr  \"75\" \"57\" \"0.01\" \"0\" ...\n $ X14         : chr  \"70\" \"53\" \"T\" \"0\" ...\n $ X15         : chr  \"64\" \"52\" \"T\" \"0\" ...\n $ X16         : chr  \"72\" \"50\" \"0\" \"0\" ...\n $ X17         : chr  \"72\" \"58\" \"0.13\" \"0\" ...\n $ X18         : chr  \"78\" \"58\" \"0\" \"0\" ...\n $ X19         : chr  \"78\" \"59\" \"T\" \"0\" ...\n $ X20         : chr  \"64\" \"54\" \"0.14\" \"0\" ...\n $ X21         : chr  \"63\" \"48\" \"0.05\" \"0\" ...\n $ X22         : chr  \"61\" \"41\" \"0\" \"0\" ...\n $ X23         : chr  \"58\" \"53\" \"0.63\" \"0\" ...\n $ X24         : chr  \"57\" \"48\" \"1.03\" \"0\" ...\n $ X25         : chr  \"57\" \"41\" \"0\" \"0\" ...\n $ X26         : chr  \"57\" \"38\" \"0\" \"0\" ...\n $ X27         : chr  \"56\" \"37\" \"T\" \"0\" ...\n $ X28         : chr  \"53\" \"45\" \"0.18\" \"0\" ...\n $ X29         : chr  \"59\" \"48\" \"0.58\" \"0\" ...\n $ X30         : chr  \"59\" \"50\" \"0.5\" \"0\" ...\n $ X31         : chr  \"52\" \"46\" \"0.25\" \"0\" ...\n $ AVG.or.Total: chr  NA NA NA \"0\" ...\n```\n:::\n:::\n\n\nIt is disappointing that everything is stored as `character` type.  That will prove advantageous in one respect because there is some `/A` garbage embedded in two of the variables (SN and PR).  Here, I will ask R to find all columns that are stored as character and ask it to remove the string.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS <- NWS %>% mutate(across(where(is.character), ~str_remove(.x, \"/A\")))\n```\n:::\n\n\nNow, we will have to fix the values `T` in the precipitation and snow variables [which are currently stored in repeated rows].  Nevertheless, this should give me what I need to create the monthly data.\n\n### Daily Data\n\nThe daily data will necessarily not involve the column of Totals/Averages that we used for the monthly data so let us eliminate it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily <- NWS %>% select(-AVG.or.Total)\n```\n:::\n\n\nNow I want to rename the columns with names X1, X2, ..., X31 to `Day.1` to `Day.31` for clarity.  It is largely inconsequential, it would work on the X's but I prefer nicely labeled intermediate steps.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(NWS.Daily) <- c(\"YR\",\"MO\",\"Variable\",paste0(\"Day.\",1:31))\n```\n:::\n\n\nThe next step is to tidy the data.  First, let me use `pivot_longer` on every column that starts with `Day.` putting the variable names in `Day` and variable values in `value`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Base <- NWS.Daily %>% \n  pivot_longer(., cols=starts_with(\"Day.\"), names_to = \"Day\", values_to = \"value\")\nhead(NWS.Daily.Base)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n     YR    MO Variable Day   value\n  <int> <int> <chr>    <chr> <chr>\n1  1940    10 TX       Day.1 <NA> \n2  1940    10 TX       Day.2 <NA> \n3  1940    10 TX       Day.3 <NA> \n4  1940    10 TX       Day.4 <NA> \n5  1940    10 TX       Day.5 <NA> \n6  1940    10 TX       Day.6 <NA> \n```\n:::\n:::\n\n\nNow I want to turn the days into numbers [they are character above] and then use `pivot_wider` to get the four variables into unique columns, recode trace [T] where they exist to numbers that are half the size of the smallest values, turn them into numbers, and create a date.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Base %<>%  mutate(Day = str_remove(Day, \"Day.\")) %>%  \n  pivot_wider(., names_from = \"Variable\", values_from = \"value\") \nNWS.Daily <- NWS.Daily.Base %>% mutate(PR = recode(PR, T = \"O.005\"), SN = recode(SN, T = \"O.005\")) %>% \n  mutate(TX = as.numeric(TX), TN = as.numeric(TN), PR = as.numeric(PR), SN = as.numeric(SN), \n         date = as.Date(paste(MO,Day,YR,sep=\"-\"), format=\"%m-%d-%Y\")\n         )\nNWS.Daily.Clean <- NWS.Daily %>% filter(!is.na(date))\nhead(NWS.Daily.Clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n     YR    MO Day      TX    TN    PR    SN date      \n  <int> <int> <chr> <dbl> <dbl> <dbl> <dbl> <date>    \n1  1940    10 1        NA    NA    NA    NA 1940-10-01\n2  1940    10 2        NA    NA    NA    NA 1940-10-02\n3  1940    10 3        NA    NA    NA    NA 1940-10-03\n4  1940    10 4        NA    NA    NA    NA 1940-10-04\n5  1940    10 5        NA    NA    NA    NA 1940-10-05\n6  1940    10 6        NA    NA    NA    NA 1940-10-06\n```\n:::\n:::\n\n\nThis is exactly what I needed.\n\n# Some Plots\n\n\n# By Day?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Clean %>% ggplot() + aes(x=date, y=PR) + geom_point(alpha=0.1) + theme_ipsum_rc() + labs(title=\"Daily Precipitation\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nThis is really pretty terrible.  This is going to need a good bit of work.  My first go is going to be to create a moving average that can smooth out the look.  I will use a 14-day moving average.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Clean %>% \n  arrange(date) %>% \n  mutate(Rolling.Average = zoo::rollmean(PR, 7, fill=NA)) %>%\n  ggplot(., aes(x=date, y=PR)) + geom_point(alpha=0.05, size=0.5) + geom_line(aes(x=date, y=Rolling.Average), inherit.aes=FALSE, color=\"red\") + theme_ipsum_rc() + labs(title=\"Daily Precipitation\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n## Time Series Plots\n\n### Daily\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Clean <- NWS.Daily.Clean %>% as_tsibble(., index=date)\nNWS.Daily.Clean %>% filter(date > \"2010-01-01\") %>% autoplot(TX) + labs(title=\"Daily High Temperatures in Portland, Oregon\", caption = \"Data from NWS\", x = \"Date\", y=\"High Temperature (deg F)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Seasonal Plots\n\n### Daily\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Clean %>% filter(date > \"2015-01-01\") %>% gg_season(TX, labels = \"both\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## Subseries Plots\n\n### Daily\n\nDaily subseries plots are a mess because there are 31 and I am not sure that there would be much instructive anyway as daily variation in temperature is quite noisy.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Clean %>% gg_subseries(TX, period=\"weeks\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n# Autocorrelation\n\nTo what degree are observations separated by k time periods correlated.\n\n$$r_{k} = \\frac{\\sum\\limits_{t=k+1}^T (y_{t}-\\bar{y})(y_{t-k}-\\bar{y})}\n {\\sum\\limits_{t=1}^T (y_{t}-\\bar{y})^2}$$\nwhere $T$ is the length of the time series. The autocorrelation coefficients make up the autocorrelation function or ACF.\n\nThe autocorrelation coefficients for the monthly high temperatures can be computed using the ACF() function.\n\n\n### Daily: ACF\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNWS.Daily.Clean %>% ACF(TX) %>% autoplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}